@startuml
title (3) Розподіл нових записів у hash-based секціонуванні

start
:Новий профіль (user_id);
:Обрати геш-функцію (MD5/SHA-1/\nмодуль з нормалізацією);
:hash = H(user_id);

if (Звичайний модуль?) then (так)
  :section = hash % n;
else (consistent hashing)
  :Кільце вузлів; \nsection = nextClockwise(hash);
endif

:Записати профіль у секцію/вузол;
note right
Властивості гешу → рівномірний розподіл.
end note

-- масштабування кластеру --
if (Додавання/видалення вузла?) then (так)
  if (consistent hashing) then (так)
    :Мігрує тільки вузька частина\nключового простору;
  else (ні)
    :Потрібно перебалансувати\nусі секції (дорого);
  endif
endif

:Моніторити обсяг/latency;\nавтоматичний ребаланс при дисбалансі;
stop
@enduml