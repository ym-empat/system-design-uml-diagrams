# Лекція 3: Реплікація та Партиціонування БД

У цій папці містяться UML діаграми, що демонструють різні підходи до реплікації баз даних, партиціонування та забезпечення консистентності в розподілених системах.

## Діаграми

### 1. Single-Leader Replication (single-leader-replication-diagram.puml)
**Строга консистентність через єдиного лідера**

Класична архітектура master-slave:
- **Leader** - єдина точка для записів, забезпечує строгу консистентність
- **Followers** - репліки тільки для читання
- **Failover** - автоматичне перемикання на новий лідер при збоях

**Використання:** фінансові системи, інвентар, де критична консистентність

### 2. Multi-Leader Replication (multi-leader-replication-diagram.puml)
**Висока доступність та низька затримка**

Розподілена архітектура з кількома лідерами:
- **Двонаправлена реплікація** між лідерами різних регіонів
- **Локальні записи** - клієнти записують у найближчий лідер
- **Конфлікти** - можливі при одночасних змінах одного ключа

**Використання:** повідомлення, соціальні мережі, міжрегіональні системи

### 3. Leaderless Replication (leaderless-replication-diagram.puml)
**Висока доступність через кворум**

Архітектура без єдиного лідера:
- **Кворум:** w + r > n (w - записи, r - читання, n - вузли)
- **Anti-entropy** - фонове вирівнювання станів між вузлами
- **Read-repair** - виправлення неконсистентностей при читанні

**Використання:** стрічки, чати, метрики, логування

### 4. Eventual Consistency (eventual-consistency-diagram.puml)
**Read-Your-Writes vs Eventual Consistency**

Демонструє різницю між типами читання:
- **Read-Your-Writes** - маршрутизація на Primary для отримання свіжих даних
- **Eventual Consistency** - читання з Secondary з можливими застарілими даними
- **Read-repair** - автоматичне виправлення застарілих реплік

### 5. Hash-Based Partitioning Schema (hash-based-partitioning-schema.puml)
**Рівномірний розподіл даних через хешування**

Стратегія партиціонування на основі хеш-функцій:
- **MD5/SHA-1** - стандартні хеш-функції
- **Модуль** - простий розподіл через остачу від ділення
- **Consistent Hashing** - мінімізація міграцій при зміні кількості вузлів

### 6. Hash-Based Partitioning Search (hash-based-partitioning-search-sequence-diagram.puml)
**Пошук в хеш-партиціонованих системах**

Демонструє ефективність різних типів запитів:
- **Exact Search** - O(1) пошук конкретного ключа
- **Range Queries** - неефективні, потребують повного обходу всіх секцій
- **Scatter/Gather** - паралельна обробка запитів до всіх партицій

### 7. Partitioning Hot Spot Detection (partitioning-hot-spot-detection.puml)
**Обробка "гарячих точок" в партиціях**

Стратегії боротьби з дисбалансом навантаження:
- **Моніторинг** - виявлення гарячих точок через метрики
- **Split/Migrate** - розділення та міграція даних
- **Кешування** - тимчасове розвантаження через кеш
- **Read Replicas** - перенаправлення читання на репліки

## Ключові концепції

### CAP Theorem
- **Consistency** - всі вузли бачать однакові дані
- **Availability** - система залишається доступною
- **Partition Tolerance** - система працює при збоях мережі

### ACID vs BASE
- **ACID** - Atomicity, Consistency, Isolation, Durability (SQL БД)
- **BASE** - Basically Available, Soft state, Eventual consistency (NoSQL)

### Типи консистентності
1. **Strong Consistency** - миттєва синхронізація
2. **Eventual Consistency** - синхронізація через час
3. **Read-Your-Writes** - гарантія бачити свої зміни
4. **Monotonic Reads** - зростаюча свіжість даних

## Архітектурні рішення

### Вибір стратегії реплікації залежить від:
- **Latency requirements** - міжрегіональні системи
- **Consistency requirements** - фінансові операції
- **Availability requirements** - критичні сервіси
- **Conflict resolution** - складність логіки вирішення конфліктів

### Вибір партиціонування залежить від:
- **Query patterns** - exact vs range запити
- **Data distribution** - рівномірність навантаження
- **Scaling requirements** - горизонтальне масштабування
- **Hot spot tolerance** - здатність обробляти дисбаланс
