# Лекція 6: API та Комунікаційні Протоколи

## Огляд

Ця лекція присвячена різним типам API та комунікаційним протоколам у розподілених системах. Розглядаються синхронні та асинхронні підходи до взаємодії між сервісами на прикладі платформи онлайн-замовлення їжі.

## Діаграми

### 1. food-delivery-api.puml

**Тема:** Послідовність API-взаємодій з позначенням протоколів

Ця діаграма демонструє різні типи API-протоколів, які використовуються в одній системі:

#### Протоколи:
- **GraphQL** — для гнучких запитів (перегляд ресторанів, підписки на оновлення статусу)
- **REST** — для стандартних CRUD-операцій (створення замовлень)
- **gRPC** — для швидкої міжсервісної комунікації (доставка, аналітика)
- **SOAP** — для інтеграції з legacy-системами (платіжний шлюз)

#### Основні сценарії:
1. **Перегляд ресторанів** — GraphQL запит для отримання меню та інформації
2. **Створення замовлення** — REST POST запит з валідацією користувача
3. **Оплата** — SOAP інтеграція з платіжним шлюзом
4. **Доставка** — gRPC для створення та відстеження доставки
5. **Трекінг замовлення** — GraphQL Subscriptions для real-time оновлень

#### Ключові концепції:
- Використання різних протоколів залежно від потреб (гнучкість vs продуктивність)
- GraphQL Subscriptions для real-time комунікації
- gRPC streaming для аналітики
- Обробка помилок оплати (alt/else)

---

### 2. food-delivery-communication.puml

**Тема:** Асинхронна комунікація через брокери повідомлень

Ця діаграма ілюструє асинхронний підхід до комунікації з використанням message brokers:

#### Технології:
- **RabbitMQ Exchange** — для розсилки подій між сервісами
- **Kafka** — для потокової обробки подій (event streaming)
- **Черги (Queues)** — для надійної доставки повідомлень

#### Архітектурні патерни:
1. **Publish-Subscribe** — одна подія обробляється кількома споживачами
2. **Fan-out** — розсилка повідомлень у різні черги
3. **Event-driven architecture** — сервіси реагують на події

#### Потік подій:
1. **OrderPlaced → RabbitMQ** → Notification Queue + Restaurant Queue
   - Notification Service надсилає push/email/SMS
   - Restaurant Service отримує інформацію про нове замовлення
   
2. **OrderEvent → Kafka** → Analytics + ML + Audit Queues
   - Паралельна обробка події різними системами
   - Збереження історії подій для аналізу

#### Переваги асинхронної комунікації:
- Відмовостійкість (якщо один сервіс недоступний, повідомлення залишається в черзі)
- Масштабованість (можна додавати споживачів незалежно)
- Розв'язка (decoupling) — сервіси не знають одне про одного

---

## Як переглянути діаграми

### Онлайн:
1. Відкрийте [PlantUML Web Server](http://www.plantuml.com/plantuml/uml/)
2. Скопіюйте вміст файлу `.puml`
3. Вставте у текстове поле

### Локально (VS Code):
```bash
# Встановіть розширення PlantUML
code --install-extension jebbs.plantuml
```

### Генерація зображень:
```bash
# Встановіть PlantUML
sudo apt-get install plantuml

# Згенеруйте PNG
plantuml food-delivery-api.puml
plantuml food-delivery-communication.puml
```

---

## Порівняння підходів

| Аспект | Синхронні API | Асинхронні повідомлення |
|--------|---------------|-------------------------|
| **Швидкість відповіді** | Миттєва | Відкладена |
| **Зв'язаність** | Тісна (tight coupling) | Слабка (loose coupling) |
| **Складність** | Проста | Вища |
| **Відмовостійкість** | Залежить від доступності | Висока (retry, persistence) |
| **Use cases** | CRUD, real-time запити | Events, notifications, analytics |

---

## Ключові висновки

1. **Не існує універсального рішення** — різні протоколи для різних потреб
2. **REST** — стандарт для публічних API та простих операцій
3. **GraphQL** — гнучкість запитів та real-time підписки
4. **gRPC** — продуктивність для внутрішньої комунікації
5. **SOAP** — legacy інтеграції
6. **Message Brokers** — асинхронна обробка, event-driven архітектура
7. **Гібридний підхід** — комбінація синхронних та асинхронних паттернів

---

## Додаткові ресурси

- [REST API Design Best Practices](https://restfulapi.net/)
- [GraphQL Documentation](https://graphql.org/)
- [gRPC Official Site](https://grpc.io/)
- [RabbitMQ Tutorials](https://www.rabbitmq.com/getstarted.html)
- [Apache Kafka Documentation](https://kafka.apache.org/documentation/)
- [Event-Driven Architecture Patterns](https://martinfowler.com/articles/201701-event-driven.html)

